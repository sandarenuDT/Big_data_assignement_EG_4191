# Kafka Orders Processing System

A real-time order processing system built with Apache Kafka, featuring Avro serialization, Schema Registry integration, and automatic Dead Letter Queue (DLQ) handling.

## Features

- **Apache Kafka** running on WSL
- **Confluent Schema Registry** for schema management
- **Avro serialization** for efficient data encoding
- **Java-based** Producer and Consumer applications
- **Automatic DLQ handling** with single retry attempt
- **Running average calculation** for order prices

---

## Project Structure

```
Kafka_Orders/
‚îî‚îÄ‚îÄ src/main/java/com/assignment/kafka/
    ‚îú‚îÄ‚îÄ OrderProducer.java    # Produces orders to Kafka
    ‚îú‚îÄ‚îÄ OrderConsumer.java    # Consumes and processes orders
    ‚îú‚îÄ‚îÄ DlqConsumer.java      # Handles failed messages
    ‚îî‚îÄ‚îÄ AvroUtils.java        # Avro serialization utilities
```

---

## Technologies Used

| Component | Technology |
|-----------|-----------|
| **Kafka Broker** | Apache Kafka 3.7 (WSL Manual Install) |
| **Schema Registry** | Confluent 7.3 |
| **Serialization** | Avro |
| **Language** | Java 17 |
| **Build Tool** | Maven |
| **DLQ Topic** | `orders-dlq` |

---

## ‚öôÔ∏è Setup Instructions

### 1Ô∏è‚É£ Start Kafka Broker on WSL

```bash
/mnt/c/kafka/kafka_2.13-3.7.0/bin/kafka-server-start.sh \
  /mnt/c/kafka/kafka_2.13-3.7.0/config/kraft/server.properties
```

### 2Ô∏è‚É£ Start Schema Registry on WSL

```bash
/opt/confluent/bin/schema-registry-start \
  /opt/confluent/etc/schema-registry/schema-registry.properties
```

**Schema Registry URL:** `http://localhost:8081`

### 3Ô∏è‚É£ Create Kafka Topics

**Create `orders` topic:**

```bash
/mnt/c/kafka/kafka_2.13-3.7.0/bin/kafka-topics.sh \
  --bootstrap-server localhost:9092 \
  --create --topic orders \
  --partitions 3 --replication-factor 1
```

**Create `orders-dlq` topic:**

```bash
/mnt/c/kafka/kafka_2.13-3.7.0/bin/kafka-topics.sh \
  --bootstrap-server localhost:9092 \
  --create --topic orders-dlq \
  --partitions 1 --replication-factor 1
```

---

## Running the Application

Each component must run in a **separate terminal window**.

### Start Order Consumer

```bash
mvn exec:java -Dexec.mainClass=com.assignment.kafka.OrderConsumer
```

### Start DLQ Consumer

```bash
mvn exec:java -Dexec.mainClass=com.assignment.kafka.DlqConsumer
```

### Start Order Producer

```bash
mvn exec:java -Dexec.mainClass=com.assignment.kafka.OrderProducer
```

---

## DLQ Logic

The consumer implements a **single retry policy**:

- **Success:** Message processed successfully
- **Failure (1 attempt):** Message immediately sent to `orders-dlq`
- **DLQ Consumer:** Reads and logs all failed messages

### Example DLQ Output

```
DLQ Received ‚Üí key=1007 | orderId=1007 | product=Item3 | price=46.12
DLQ Received ‚Üí key=1004 | orderId=1004 | product=Item2 | price=28.90
DLQ Received ‚Üí key=10013 | orderId=10013 | product=Item5 | price=73.41
```

---

## Running Average Calculation

The consumer maintains a running average of order prices using the formula:

```java
runningAvg = runningAvg + (price - runningAvg) / count
```

This provides real-time insights into pricing trends without storing all historical data.

---

## Avro Schema

```json
{
  "type": "record",
  "name": "Order",
  "namespace": "com.assignment.avro",
  "doc": "Represents an e-commerce order event that flows through the Kafka pipeline. This schema defines the structure of each order message produced by the OrderProducer.",
  "fields": [
    {
      "name": "orderId",
      "type": "string",
      "doc": "A unique identifier for the order. Used as the Kafka message key and helps maintain ordering per customer/product."
    },
    {
      "name": "product",
      "type": "string",
      "doc": "The product name or code associated with the order. One of Item1‚ÄìItem5 in this assignment."
    },
    {
      "name": "price",
      "type": "float",
      "doc": "The total price of the order. A floating-point value between 20‚Äì100 as generated by the producer."
    }
  ]
}
```

---

## ‚úÖ Verification Checklist

- ‚úîÔ∏è Kafka running manually on WSL
- ‚úîÔ∏è Schema Registry running and accessible
- ‚úîÔ∏è Avro serialization functioning correctly
- ‚úîÔ∏è Producer successfully sending orders
- ‚úîÔ∏è Consumer processing orders and calculating running average
- ‚úîÔ∏è Failed messages automatically routed to DLQ
- ‚úîÔ∏è DLQ consumer reading and logging failed orders

---

## üõ† Troubleshooting

### Schema Registry Connection Issues

Ensure Schema Registry is running and accessible:

```bash
curl http://localhost:8081/subjects
```

### Kafka Topic Issues

List all topics to verify creation:

```bash
/mnt/c/kafka/kafka_2.13-3.7.0/bin/kafka-topics.sh \
  --bootstrap-server localhost:9092 \
  --list
```
